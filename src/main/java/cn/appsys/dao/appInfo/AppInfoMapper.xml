<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.appsys.dao.appInfo.AppInfoMapper">
    <select id="getAppInfoList" resultType="AppInfo">
        SELECT i.`id`,i.`softwareName`,i.`APKName`,i.`supportROM`,i.`interfaceLanguage`,
        i.`softwareSize`,i.`updateDate`,i.`devId`,i.`appInfo`,i.`status`,i.`onSaleDate`,
        i.`offSaleDate`,i.`flatformId`,i.`categoryLevel3`,i.`downloads`,i.`createdBy`,
        i.`creationDate`,i.`modifyBy`,i.`modifyDate`,i.`categoryLevel1`,i.`categoryLevel2`,
        i.`logoPicPath`,i.`logoLocPath`,i.`versionId`,
        (SELECT `devName`FROM `dev_user` WHERE `id`=i.`devId`) AS devName,
        (SELECT `valueName` FROM `data_dictionary` WHERE i.`status`=`valueId`
        AND `typeCode`='APP_STATUS') AS statusName,
        (SELECT `valueName` FROM `data_dictionary` WHERE i.`flatformId`=`valueId`
        AND `typeCode`='APP_FLATFORM')AS flatformName,
        (SELECT `categoryName` FROM `app_category` WHERE `id`=i.`categoryLevel1`)AS categoryLevel1Name,
        (SELECT `categoryName` FROM `app_category` WHERE `id`=i.`categoryLevel2`)AS categoryLevel2Name,
        (SELECT `categoryName` FROM `app_category` WHERE `id`=i.`categoryLevel3`)AS categoryLevel3Name,
        (SELECT `versionNo` FROM `app_version` WHERE `id`=i.`versionId`)AS versionNo
        FROM `app_info` i
        <trim prefix="where" prefixOverrides="and | or">
            <if test="softwareName != null and softwareName != ''">
                and i.softwareName like CONCAT ('%',#{softwareName},'%')
            </if>
            <if test="flatformId != null and flatformId>0">
                and i.flatformId = #{flatformId}
            </if>
            <if test="categoryLevel1 != null and categoryLevel1>0">
                and i.categoryLevel1 = #{categoryLevel1}
            </if>
            <if test="categoryLevel2 != null and categoryLevel2>0">
                and i.categoryLevel2 = #{categoryLevel2}
            </if>
            <if test="categoryLevel3 != null and categoryLevel3>0">
                and i.categoryLevel3 = #{categoryLevel3}
            </if>
        </trim>
        order by creationDate DESC limit 0,6

    </select>
    <select id="getAppinfoCount" resultType="Integer">
        SELECT COUNT(1) FROM `app_info`
        <trim prefix="where" prefixOverrides="and | or">
            <if test="softwareName != null and softwareName != ''">
                and softwareName like CONCAT ('%',#{softwareName},'%')
            </if>
            <if test="flatformId != null and flatformId>0">
                and flatformId = #{flatformId}
            </if>
            <if test="categoryLevel1 != null  and categoryLevel1>0">
                and categoryLevel1 = #{categoryLevel1}
            </if>
            <if test="categoryLevel2 != null and categoryLevel2>0">
                and categoryLevel2 = #{categoryLevel2}
            </if>
            <if test="categoryLevel3 != null and categoryLevel3>0">
                and categoryLevel3 = #{categoryLevel3}
            </if>
        </trim>
    </select>
    <!--
     <if test="status != null">
           and a.status = #{status}
       </if>
       <if test="categoryLevel1 != null">
           and a.categoryLevel1 = #{categoryLevel1}
       </if>
       <if test="categoryLevel2 != null">
           and a.categoryLevel2 = #{categoryLevel2}
       </if>
       <if test="categoryLevel3 != null">
           and a.categoryLevel3 = #{categoryLevel3}
       </if>

       <if test="devId != null">
           and a.devId = #{devId}
       </if>
        limit #{from},#{pageSize}
   -->
</mapper>